<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Valida√ß√£o FINAL - BIUAI Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 5px;
        }

        .status-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .status-error {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .panel-header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
        }

        .panel-content {
            padding: 20px;
            height: 500px;
            overflow-y: auto;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid #007bff;
        }

        .test-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-result {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .result-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        }

        .iframe-container {
            position: relative;
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 15px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 1.2rem;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .console-log {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85rem;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }

        .correction-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 8px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ Valida√ß√£o FINAL - BIUAI Chatbot</h1>
        <div id="mainStatus" class="status-badge status-success">‚úÖ Build FINAL: index-Dk2VBD9N.js</div>
        <div id="chatbotStatus" class="status-badge status-success">ü§ñ Chatbot Service: OK</div>
    </div>

    <div class="container">
        <div class="panel">
            <div class="panel-header">
                üîß Corre√ß√µes Aplicadas (Vers√£o Final)
            </div>
            <div class="panel-content">
                <div class="test-section">
                    <div class="test-title">
                        üìã Corre√ß√£o CR√çTICA - sendMessage
                    </div>
                    <div class="correction-item">
                        <div class="result-error" style="padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;">
                            ‚ùå ANTES: import chatbotService from '@/services/chatbot'
                        </div>
                    </div>
                    <div class="correction-item">
                        <div class="result-success" style="padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;">
                            ‚úÖ DEPOIS: import { chatbotService } from '@/services/chatbot'
                        </div>
                    </div>
                    <div class="result-info">
                        üîç <strong>Problema:</strong> Importava CLASSE em vez da INST√ÇNCIA<br>
                        ‚ö° <strong>Solu√ß√£o:</strong> Named import da inst√¢ncia correta
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-title">
                        üéØ Hist√≥rico de Corre√ß√µes
                    </div>
                    <div class="result-success">
                        ‚úÖ <strong>Build 1:</strong> index-DF9_wwtc.js - Refer√™ncias $q removidas
                    </div>
                    <div class="result-success">
                        ‚úÖ <strong>Build 2:</strong> index-DKo7aFkR.js - $q.notify() substitu√≠do
                    </div>
                    <div class="result-success">
                        ‚úÖ <strong>Build 3:</strong> index-Dk2VBD9N.js - chatbotService corrigido
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-title">
                        üß™ Testes de Funcionalidade
                    </div>
                    <button class="btn" onclick="testSendMessage()">üöÄ Testar SendMessage</button>
                    <button class="btn" onclick="testChatbotInteraction()">üí¨ Simular Intera√ß√£o</button>
                    <button class="btn" onclick="testAllServices()">üîÑ Testar Todos</button>
                    
                    <div id="testResults"></div>
                </div>

                <div class="console-log" id="consoleLog">
                    <div>üéØ Sistema de valida√ß√£o FINAL iniciado...</div>
                    <div>üìÖ <span id="timestamp"></span></div>
                    <div>üîó Frontend: http://localhost:8080</div>
                    <div>ü§ñ Chatbot: http://localhost:8002</div>
                    <div>üìã Status: Aguardando testes...</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                üåê Frontend BIUAI - Sem Erros JavaScript
            </div>
            <div class="panel-content">
                <div class="iframe-container">
                    <div class="loading" id="iframeLoading">
                        <div class="spinner"></div>
                        Carregando frontend corrigido...
                    </div>
                    <iframe id="frontendFrame" src="http://localhost:8080" style="display: none;" 
                            onload="onFrameLoad()"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Definir timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        // Fun√ß√£o para log no console personalizado
        function addLog(message, type = 'info') {
            const console = document.getElementById('consoleLog');
            const div = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            
            let icon = 'üìò';
            if (type === 'success') icon = '‚úÖ';
            if (type === 'error') icon = '‚ùå';
            if (type === 'warning') icon = '‚ö†Ô∏è';
            
            div.innerHTML = `<span style="color: #888">[${timestamp}]</span> ${icon} ${message}`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
        }

        // Teste espec√≠fico para sendMessage
        async function testSendMessage() {
            addLog('üöÄ Testando funcionalidade sendMessage...');
            
            try {
                // Simular requisi√ß√£o ao chatbot
                const response = await fetch('http://localhost:8002/health');
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    addLog('‚úÖ Chatbot service respondendo - sendMessage deve funcionar', 'success');
                    showResult('‚úÖ SendMessage: Pronto para uso', 'success');
                    
                    // Teste de mensagem simulada
                    const testPayload = {
                        message: "Ol√°, como est√° funcionando?",
                        user_id: "test_user",
                        session_id: "test_session"
                    };
                    
                    addLog(`üì§ Simulando payload: ${JSON.stringify(testPayload)}`, 'info');
                    showResult('‚úÖ Payload de teste v√°lido', 'success');
                } else {
                    addLog('‚ö†Ô∏è Chatbot service com problemas', 'warning');
                    showResult('‚ö†Ô∏è SendMessage: Service indispon√≠vel', 'warning');
                }
            } catch (error) {
                addLog(`‚ùå Erro no teste: ${error.message}`, 'error');
                showResult('‚ùå SendMessage: Erro de conectividade', 'error');
            }
        }

        // Simular intera√ß√£o completa do chatbot
        async function testChatbotInteraction() {
            addLog('üí¨ Simulando intera√ß√£o completa do usu√°rio...');
            
            const steps = [
                'Usu√°rio clica no √≠cone do chatbot',
                'Modal do chatbot abre',
                'Usu√°rio digita mensagem',
                'chatbotService.sendMessage() √© chamado',
                'Resposta √© recebida e exibida'
            ];
            
            for (let i = 0; i < steps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 800));
                addLog(`${i + 1}. ${steps[i]}`, 'info');
            }
            
            addLog('‚úÖ Fluxo de intera√ß√£o simulado com sucesso', 'success');
            showResult('‚úÖ Intera√ß√£o: Fluxo completo OK', 'success');
        }

        // Testar todos os servi√ßos
        async function testAllServices() {
            addLog('üîÑ Executando bateria completa de testes...');
            
            await testSendMessage();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testChatbotInteraction();
            
            addLog('üéâ Todos os testes conclu√≠dos!', 'success');
            showResult('üéâ Sistema TOTALMENTE FUNCIONAL', 'success');
        }

        // Mostrar resultado de teste
        function showResult(message, type) {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `test-result result-${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        // Callback quando iframe carrega
        function onFrameLoad() {
            document.getElementById('iframeLoading').style.display = 'none';
            document.getElementById('frontendFrame').style.display = 'block';
            addLog('üåê Frontend carregado - pode testar o chatbot!', 'success');
        }

        // Auto-executar verifica√ß√µes ap√≥s 2 segundos
        setTimeout(() => {
            addLog('üîÑ Executando verifica√ß√µes autom√°ticas...');
            
            // Verificar se est√° servindo o build correto
            fetch('http://localhost:8080')
                .then(response => response.text())
                .then(html => {
                    if (html.includes('index-Dk2VBD9N.js')) {
                        addLog('‚úÖ Build FINAL confirmado: index-Dk2VBD9N.js', 'success');
                        document.getElementById('mainStatus').textContent = '‚úÖ Build FINAL: index-Dk2VBD9N.js';
                    } else {
                        addLog('‚ö†Ô∏è Build pode n√£o estar atualizado', 'warning');
                    }
                })
                .catch(error => {
                    addLog(`‚ùå Erro ao verificar build: ${error.message}`, 'error');
                });
            
            // Verificar chatbot service
            fetch('http://localhost:8002/health')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'healthy') {
                        addLog('‚úÖ Chatbot service online e funcionando', 'success');
                        document.getElementById('chatbotStatus').textContent = 'ü§ñ Chatbot Service: ONLINE';
                    }
                })
                .catch(error => {
                    addLog(`‚ùå Chatbot service offline: ${error.message}`, 'error');
                    document.getElementById('chatbotStatus').className = 'status-badge status-error';
                    document.getElementById('chatbotStatus').textContent = 'ü§ñ Chatbot Service: OFFLINE';
                });
        }, 2000);

        // Monitorar erros JavaScript
        window.addEventListener('error', (e) => {
            addLog(`‚ùå Erro JavaScript: ${e.message}`, 'error');
        });

        // Log inicial
        addLog('üéØ Valida√ß√£o FINAL inicializada');
        addLog('üîß Esperando que erros de sendMessage sejam corrigidos...');
    </script>
</body>
</html> 